<!DOCTYPE html>
<!-- æ±½è½¦åœ°å›¾å¯¼èˆªç³»ç»Ÿå‰ç«¯é¡µé¢ - ç”¨æˆ·äº¤äº’ç•Œé¢ -->
<html lang="zh-CN">
<head>
    <!-- é¡µé¢å…ƒæ•°æ®é…ç½® -->
    <meta charset="UTF-8"> <!-- å­—ç¬¦ç¼–ç è®¾ç½® -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- å“åº”å¼è®¾è®¡é…ç½® -->
    <title>æ±½è½¦åœ°å›¾å¯¼èˆªç³»ç»Ÿ</title> <!-- é¡µé¢æ ‡é¢˜ -->
    
    <!-- é¡µé¢æ ·å¼å®šä¹‰ -->
    <style>
        /* é¡µé¢æ•´ä½“æ ·å¼ */
        body {
            font-family: Arial, sans-serif; /* å­—ä½“è®¾ç½® */
            margin: 0; /* å¤–è¾¹è·æ¸…é›¶ */
            padding: 20px; /* å†…è¾¹è·è®¾ç½® */
            background-color: #f5f5f5; /* èƒŒæ™¯é¢œè‰² */
        }
        
        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1200px; /* æœ€å¤§å®½åº¦é™åˆ¶ */
            margin: 0 auto; /* å±…ä¸­å¯¹é½ */
            background: white; /* èƒŒæ™¯è‰² */
            padding: 20px; /* å†…è¾¹è· */
            border-radius: 8px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* é˜´å½±æ•ˆæœ */
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            color: #333; /* æ–‡å­—é¢œè‰² */
            text-align: center; /* å±…ä¸­å¯¹é½ */
        }
        
        /* é¢æ¿æ ·å¼ */
        .panel {
            margin: 20px 0; /* å¤–è¾¹è· */
            padding: 15px; /* å†…è¾¹è· */
            border: 1px solid #ddd; /* è¾¹æ¡† */
            border-radius: 5px; /* åœ†è§’ */
        }
        
        /* è¡¨å•ç»„æ ·å¼ */
        .form-group {
            margin: 10px 0; /* å¤–è¾¹è· */
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        label {
            display: block; /* å—çº§å…ƒç´  */
            margin-bottom: 5px; /* ä¸‹å¤–è¾¹è· */
            font-weight: bold; /* ç²—ä½“ */
        }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        input, select {
            width: 100%; /* å®½åº¦100% */
            padding: 8px; /* å†…è¾¹è· */
            border: 1px solid #ccc; /* è¾¹æ¡† */
            border-radius: 4px; /* åœ†è§’ */
            box-sizing: border-box; /* ç›’æ¨¡å‹ */
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            background-color: #007bff; /* èƒŒæ™¯è‰² */
            color: white; /* æ–‡å­—é¢œè‰² */
            padding: 10px 20px; /* å†…è¾¹è· */
            border: none; /* æ— è¾¹æ¡† */
            border-radius: 4px; /* åœ†è§’ */
            cursor: pointer; /* é¼ æ ‡æ‰‹åŠ¿ */
            margin: 5px; /* å¤–è¾¹è· */
        }
        
        /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
        button:hover {
            background-color: #0056b3; /* æ‚¬åœèƒŒæ™¯è‰² */
        }
        
        /* è½¦è¾†åˆ—è¡¨æ ·å¼ */
        .car-list {
            margin-top: 20px; /* ä¸Šå¤–è¾¹è· */
        }
        
        /* è½¦è¾†é¡¹ç›®æ ·å¼ */
        .car-item {
            padding: 10px; /* å†…è¾¹è· */
            border: 1px solid #eee; /* è¾¹æ¡† */
            margin: 5px 0; /* å¤–è¾¹è· */
            border-radius: 4px; /* åœ†è§’ */
            background-color: #f9f9f9; /* èƒŒæ™¯è‰² */
        }
        
        /* è·¯çº¿ä¿¡æ¯æ ·å¼ */
        .route-info {
            background-color: #e7f3ff; /* èƒŒæ™¯è‰² */
            padding: 15px; /* å†…è¾¹è· */
            border-radius: 4px; /* åœ†è§’ */
            margin: 10px 0; /* å¤–è¾¹è· */
        }
    </style>
</head>

<body>
    <!-- é¡µé¢ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div class="container">
        <!-- é¡µé¢ä¸»æ ‡é¢˜ -->
        <h1>ğŸš— æ±½è½¦åœ°å›¾å¯¼èˆªç³»ç»Ÿ</h1>
        
        <!-- è½¦è¾†ä½ç½®æ›´æ–°é¢æ¿ -->
        <div class="panel">
            <h2>ğŸ“ æ›´æ–°è½¦è¾†ä½ç½®</h2>
            
            <!-- è½¦ç‰Œå·è¾“å…¥ -->
            <div class="form-group">
                <label>è½¦ç‰Œå·:</label>
                <input type="text" id="carName" placeholder="å¦‚: è‹K12345">
            </div>
            
            <!-- çº¬åº¦è¾“å…¥ -->
            <div class="form-group">
                <label>çº¬åº¦:</label>
                <input type="number" id="latitude" step="0.0001" placeholder="32.3931">
            </div>
            
            <!-- ç»åº¦è¾“å…¥ -->
            <div class="form-group">
                <label>ç»åº¦:</label>
                <input type="number" id="longitude" step="0.0001" placeholder="119.4128">
            </div>
            
            <!-- çŠ¶æ€é€‰æ‹© -->
            <div class="form-group">
                <label>çŠ¶æ€:</label>
                <select id="status">
                    <option value="active">è¿è¡Œä¸­</option>
                    <option value="inactive">åœæ­¢</option>
                    <option value="maintenance">ç»´ä¿®ä¸­</option>
                </select>
            </div>
            
            <!-- æ›´æ–°ä½ç½®æŒ‰é’® -->
            <button onclick="updateLocation()">æ›´æ–°ä½ç½®</button>
        </div>

        <!-- è·¯çº¿è§„åˆ’é¢æ¿ -->
        <div class="panel">
            <h2>ğŸ—ºï¸ è·¯çº¿è§„åˆ’</h2>
            
            <!-- èµ·ç‚¹è¾“å…¥ -->
            <div class="form-group">
                <label>èµ·ç‚¹:</label>
                <input type="text" id="startPoint" placeholder="å¦‚: æ‰¬å·">
            </div>
            
            <!-- ç»ˆç‚¹è¾“å…¥ -->
            <div class="form-group">
                <label>ç»ˆç‚¹:</label>
                <input type="text" id="endPoint" placeholder="å¦‚: å—äº¬">
            </div>
            
            <!-- è§„åˆ’è·¯çº¿æŒ‰é’® -->
            <button onclick="planRoute()">è§„åˆ’è·¯çº¿</button>
            
            <!-- è·¯çº¿ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div id="routeResult"></div>
        </div>

        <!-- è½¦è¾†åˆ—è¡¨é¢æ¿ -->
        <div class="panel">
            <h2>ğŸ“‹ è½¦è¾†åˆ—è¡¨</h2>
            
            <!-- åŠŸèƒ½æŒ‰é’® -->
            <button onclick="loadCars()">åˆ·æ–°è½¦è¾†åˆ—è¡¨</button>
            <button onclick="loadActiveCars()">æŸ¥çœ‹è¿è¡Œä¸­è½¦è¾†</button>
            
            <!-- è½¦è¾†åˆ—è¡¨æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="carList" class="car-list"></div>
        </div>
    </div>

    <!-- JavaScripté€»è¾‘éƒ¨åˆ† -->
    <script>
        /**
         * æ›´æ–°è½¦è¾†ä½ç½®åŠŸèƒ½
         * é€šè¿‡AJAXè°ƒç”¨åç«¯APIæ›´æ–°è½¦è¾†GPSä½ç½®ä¿¡æ¯
         */
        function updateLocation() {
            // æ„é€ è½¦è¾†æ•°æ®å¯¹è±¡
            const carData = {
                carName: document.getElementById('carName').value, // è·å–è½¦ç‰Œå·
                latitude: parseFloat(document.getElementById('latitude').value), // è·å–çº¬åº¦
                longitude: parseFloat(document.getElementById('longitude').value), // è·å–ç»åº¦
                status: document.getElementById('status').value // è·å–çŠ¶æ€
            };

            // å‘é€POSTè¯·æ±‚åˆ°åç«¯API
            fetch('/api/map/location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // è®¾ç½®è¯·æ±‚å¤´
                },
                body: JSON.stringify(carData) // å°†æ•°æ®è½¬æ¢ä¸ºJSONæ ¼å¼
            })
            .then(response => response.json()) // è§£æå“åº”ä¸ºJSON
            .then(data => {
                alert('è½¦è¾†ä½ç½®æ›´æ–°æˆåŠŸï¼'); // æ˜¾ç¤ºæˆåŠŸæç¤º
                loadCars(); // åˆ·æ–°è½¦è¾†åˆ—è¡¨
            })
            .catch(error => {
                console.error('Error:', error); // è¾“å‡ºé”™è¯¯ä¿¡æ¯
                alert('æ›´æ–°å¤±è´¥ï¼š' + error.message); // æ˜¾ç¤ºé”™è¯¯æç¤º
            });
        }

        /**
         * è·¯çº¿è§„åˆ’åŠŸèƒ½
         * è°ƒç”¨åç«¯è·¯çº¿è§„åˆ’APIè·å–å¯¼èˆªä¿¡æ¯
         */
        function planRoute() {
            // è·å–èµ·ç‚¹å’Œç»ˆç‚¹è¾“å…¥å€¼
            const start = document.getElementById('startPoint').value;
            const end = document.getElementById('endPoint').value;

            // è¾“å…¥éªŒè¯
            if (!start || !end) {
                alert('è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹');
                return;
            }

            // å‘é€è·¯çº¿è§„åˆ’è¯·æ±‚
            fetch(`/api/map/route?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`)
            .then(response => response.json()) // è§£æå“åº”
            .then(data => {
                // æ˜¾ç¤ºè·¯çº¿è§„åˆ’ç»“æœ
                document.getElementById('routeResult').innerHTML = `
                    <div class="route-info">
                        <h3>è·¯çº¿ä¿¡æ¯</h3>
                        <p><strong>è·ç¦»:</strong> ${data.distance} å…¬é‡Œ</p>
                        <p><strong>è·¯çº¿:</strong> ${data.routeInfo}</p>
                        <p><strong>èµ·ç‚¹:</strong> ${data.startPoint}</p>
                        <p><strong>ç»ˆç‚¹:</strong> ${data.endPoint}</p>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('è·¯çº¿è§„åˆ’å¤±è´¥ï¼š' + error.message);
            });
        }

        /**
         * åŠ è½½æ‰€æœ‰è½¦è¾†åˆ—è¡¨
         * ä»åç«¯è·å–å®Œæ•´çš„è½¦è¾†ä½ç½®ä¿¡æ¯
         */
        function loadCars() {
            fetch('/api/map/locations') // å‘é€GETè¯·æ±‚è·å–æ‰€æœ‰è½¦è¾†
            .then(response => response.json())
            .then(data => {
                displayCars(data); // æ˜¾ç¤ºè½¦è¾†åˆ—è¡¨
            })
            .catch(error => {
                console.error('Error:', error);
                alert('åŠ è½½è½¦è¾†åˆ—è¡¨å¤±è´¥');
            });
        }

        /**
         * åŠ è½½è¿è¡Œä¸­è½¦è¾†åˆ—è¡¨
         * ä»åç«¯è·å–çŠ¶æ€ä¸ºactiveçš„è½¦è¾†ä¿¡æ¯
         */
        function loadActiveCars() {
            fetch('/api/map/active-cars') // å‘é€GETè¯·æ±‚è·å–æ´»è·ƒè½¦è¾†
            .then(response => response.json())
            .then(data => {
                displayCars(data); // æ˜¾ç¤ºè½¦è¾†åˆ—è¡¨
            })
            .catch(error => {
                console.error('Error:', error);
                alert('åŠ è½½è¿è¡Œä¸­è½¦è¾†å¤±è´¥');
            });
        }

        /**
         * æ˜¾ç¤ºè½¦è¾†åˆ—è¡¨
         * å°†è½¦è¾†æ•°æ®æ¸²æŸ“ä¸ºHTMLåˆ—è¡¨
         */
        function displayCars(cars) {
            const carList = document.getElementById('carList');
            
            // å¤„ç†ç©ºæ•°æ®æƒ…å†µ
            if (cars.length === 0) {
                carList.innerHTML = '<p>æš‚æ— è½¦è¾†æ•°æ®</p>';
                return;
            }

            // æ¸²æŸ“è½¦è¾†åˆ—è¡¨HTML
            carList.innerHTML = cars.map(car => `
                <div class="car-item">
                    <strong>è½¦ç‰Œå·:</strong> ${car.carName} <br>
                    <strong>ä½ç½®:</strong> (${car.latitude}, ${car.longitude}) <br>
                    <strong>çŠ¶æ€:</strong> ${getStatusText(car.status)} <br>
                    <strong>æ›´æ–°æ—¶é—´:</strong> ${new Date().toLocaleString()}
                </div>
            `).join('');
        }

        /**
         * è·å–çŠ¶æ€æ–‡æœ¬æ˜¾ç¤º
         * å°†è‹±æ–‡çŠ¶æ€ç è½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤º
         */
        function getStatusText(status) {
            const statusMap = {
                'active': 'ğŸŸ¢ è¿è¡Œä¸­',
                'inactive': 'ğŸ”´ åœæ­¢',
                'maintenance': 'ğŸŸ¡ ç»´ä¿®ä¸­'
            };
            return statusMap[status] || status;
        }

        /**
         * é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ
         * åˆå§‹åŒ–è½¦è¾†åˆ—è¡¨æ˜¾ç¤º
         */
        window.onload = function() {
            loadCars(); // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–è½¦è¾†åˆ—è¡¨
        };
    </script>
</body>
</html>